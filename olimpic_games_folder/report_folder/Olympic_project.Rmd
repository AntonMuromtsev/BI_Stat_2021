---
title: "Olympiades project"
author: "Anton Muromstev"
date: "11/7/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = '../data_folder')
```

# Introduction 

Project is devoted to analysis of various sportsmen characteristics participated
in Olympic games

### Libraries required 

If you are working manually please connect libraries in order listed below

```{r libraries}
if(!require(Rmisc)) install.packages("Rmisc")
if(!require(ggpubr)) install.packages("ggpubr")
if(!require(dplyr)) install.packages("dplyr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(tableHTML)) install.packages("tableHTML")
library(Rmisc)
library(ggpubr)
library(dplyr)
library(ggplot2)
library(tableHTML)
```

# Data Preprocessing

### Create function to bind data

Since there are several .csv files in our project we provide function to bind all files in one dataframe. We also provide ability to bind .tsv files. Note that function interpretate blank spaces as NAs and creates dplyr dataframe. Use function after setting directory with files as working directory

```{r bind_function}

results_bind <- function(extenction) {
  
  file_names <- list.files(pattern = paste0("*.", extenction))
  if (extenction == "csv") {
    frames <- lapply(file_names, read.csv, na.strings = c("NA", ""))
  } else if (extenction == "tsv") {
    frames <- lapply(file_names, read.table, sep = '\t', 
                     header = TRUE, na.strings = c("NA", ""))
  }
  frames_binded <- do.call("rbind", frames)
  final_frame <- as_data_frame(frames_binded)
  return(final_frame)
}

```

### Create the frame from files and check it

```{r}
raw_frame <-  results_bind("csv")
str(raw_frame)

```
### Working with NAs and types

It turned out that Height and Weight variables together account for nearly 25% of the NAs in the raw dataframe, so we firstly filtered others' variables NAs thus creating filt_frame and then on the base of **filt_frame** we filtered Height and Weight NAs resulted in **HW_filt_frame** (this dataframe will be used in analysis connected with Height and Weight respectively). Additionally we replaced all NAs to "participant" in Medal variable.

We assumed Sex, Season and Medal as factors (types of other variables were not changed)

```{r}
raw_frame$Medal[is.na(raw_frame$Medal)] <- "participant"

filt_frame <- filter(raw_frame, !is.na(Name),
                     !is.na(Age),
                     !is.na(Sex),
                     Sex != "G", 
                     !is.na(Team), 
                     !is.na(NOC), 
                     !is.na(Games), 
                     !is.na(Year), 
                     !is.na(Season),
                     !is.na(City),
                     !is.na(Sport), 
                     !is.na(Event)) %>% 
  mutate( Sex = as.factor(Sex),
          Season = as.factor(Season), 
          Medal = as.factor(Medal)) 

HW_filt_frame <- filter(filt_frame, !is.na(Height), !is.na(Weight))
```

# Data analysis

### Check the most uvenile age of both sexes in 1992

```{r}
age_uvenile_by_sex_1992 <- filter(filt_frame, Games %in% c("1992 Summer", "1992 Winter"))  %>% 
  group_by(Sex) %>% summarise(min(Age))
tableHTML(age_uvenile_by_sex_1992)
```

### Check the mean and standart deviation of Height for both sexes

Note that **HW_filt_frame** was used (this dataframe does not incude any NAs from Weight or Height)

```{r}
Height_stat_by_sex <- group_by(HW_filt_frame, Sex) %>% 
  summarise(mean =  round(mean(Height), digits = 3), sd = round(sd(Height), digits = 3))
tableHTML(Height_stat_by_sex)

```
### Check the mean and standart deviation of Height for female Tennis players on 2000 olympiade

```{r}
Height_stat_F_Tennis_2000 <- filter(HW_filt_frame, Sex == "F",
                            Games %in% c("2000 Summer", "2000 Winter"),
                            Sport == "Tennis") %>% 
          summarise(Mean = round(mean(Height), 
          digits = 1), SD = round(sd(Height), digits = 1)) 
tableHTML(Height_stat_F_Tennis_2000)
```

### Find the heaviest athlet on 2006 olympiade and the sport type he participated in 

```{r}
Sport_most_weight_2006_M <- filter(HW_filt_frame, Games %in% c("2006 Summer", "2006 Winter"),
                                   Sex == "M") %>% filter(Weight == max(Weight))
Sport_most_weight_2006_M$Sport
```
### Calculate the Number of women rewarded with gold medal on Olympic games from 1980 to 2010

```{r}
F_Gold_Medal_1980.2010_count <- nrow(filter(filt_frame, Sex == "F", Year %in% c(1980:2010), 
                                       Medal == "Gold"))
F_Gold_Medal_1980.2010_count
```

### Find how many times John Aalberg participated in Olympic Games throughout his career 

```{r}
John_Aalberg_count <- nrow(filter(filt_frame, Name  == "John Aalberg"))
John_Aalberg_count
```

### Organize age-related sportsmen groups on 2008 Olympiade. Check the most and the less represented group respectfully

```{r}
number_AgeGroups_2008 <- c(nrow(filter(filt_frame, Age %in% 15:24, Year == 2008)),
                           nrow(filter(filt_frame, Age %in% 25:34, Year == 2008)),
                           nrow(filter(filt_frame, Age %in% 35:44, Year == 2008)),
                           nrow(filter(filt_frame, Age %in% 45:55, Year == 2008)))
names(number_AgeGroups_2008) <- c("[15-25)", "[25-35)", "[35-45)", "[45-55]")
number_AgeGroups_2008
min(number_AgeGroups_2008)
max(number_AgeGroups_2008)
```

### Calculate the difference in variety between 1994 and 2002 Olympiades

```{r}
sport_variety_1994 <- filter(filt_frame, Year == 1994) %>% 
  summarise(sport_variety_1994 = unique(Sport))
sport_variety_2002 <- filter(filt_frame, Year == 2002) %>% 
  summarise(sport_variety_2002 = unique(Sport))

Diff_sport_variety_1994_2002 <- nrow(sport_variety_2002) - nrow(sport_variety_1994)
Diff_sport_variety_1994_2002
```

### Find Top 3 countries for each Medal type (Gold, Silver, Bronze)

```{r}
Summer_Gold <- filter(filt_frame, Season == "Summer", Medal == "Gold") %>% group_by(NOC) %>% 
  summarise(Gold_Summer = length(Medal)) %>% arrange(desc(Gold_Summer)) %>% slice(1:3)

Summer_Silver <- filter(filt_frame, Season == "Summer", Medal == "Silver") %>% group_by(NOC) %>% 
  summarise(Silver_Summer = length(Medal)) %>% arrange(desc(Silver_Summer)) %>% slice(1:3)

Summer_Broze <- filter(filt_frame, Season == "Summer", Medal == "Bronze") %>% group_by(NOC) %>% 
  summarise(Bronse_Summer = length(Medal)) %>% arrange(desc(Bronse_Summer)) %>% slice(1:3)

Winter_Gold <- filter(filt_frame, Season == "Winter", Medal == "Gold") %>% group_by(NOC) %>% 
  summarise(Gold_Winter = length(Medal)) %>% arrange(desc(Gold_Winter)) %>% slice(1:3)

Winter_Silver <- filter(filt_frame, Season == "Winter", Medal == "Silver") %>% group_by(NOC) %>% 
  summarise(Silver_Winter = length(Medal)) %>% arrange(desc(Silver_Winter)) %>% slice(1:3)

Winter_Bronse <- filter(filt_frame, Season == "Winter", Medal == "Bronze") %>% group_by(NOC) %>% 
  summarise(Broze_Winter = length(Medal)) %>% arrange(desc(Broze_Winter)) %>% slice(1:3)

Top3_MedalDiff_SeasonDiff = list(Summer_Gold,
                                 Summer_Silver, 
                                 Summer_Broze,
                                 Winter_Gold, 
                                 Winter_Silver,
                                 Winter_Bronse)
tableHTML(as.data.frame(Top3_MedalDiff_SeasonDiff))
```

### Perform z-standartization of variable Height 

```{r}
HW_filt_Zst_frame <- mutate(HW_filt_frame,
                           Height_z_scores = (Height - mean(Height))/sd(Height))
head(HW_filt_Zst_frame$Height_z_scores)
```

### Perform min-max standartization of variable Height

```{r}
HW_filt_MMst_frame <- mutate(HW_filt_frame,
    Height_min_max_scaled = (Height - min(Height))/(max(Height) - min(Height)))
head(HW_filt_MMst_frame$Height_min_max_scaled)
```

### Compare Heigth, Weight and Age of women and men participated in winter Olympiades

We used wilcoxon test instead of t-test as there may be depentent observations (in particular, when this competitor participates in more than 1 seasons). We used  **HW_filt_frame** to compare Weight and Height and **filt_frame** to compare age.

```{r}
Winter_HW <- filter(HW_filt_frame, Season == "Winter" )
Winter <-  filter(filt_frame, Season == "Winter")
```
#### Compare Weight

```{r}
wilcox.test(Winter_HW$Weight[Winter_HW$Sex == "M"],
            Winter_HW$Weight[Winter_HW$Sex == "F"])

ggplot(Winter_HW, aes(x = Sex, y = Weight))+
  geom_boxplot(fill = "cadetblue1")+
  stat_compare_means(method = "wilcox.test", comparisons = list(c("F", "M")))+
  labs(title = "Competitors Weight on Winter Olympic Games",
       caption = "wilcoxon test performed")
```

#### Compare Height 

```{r}
wilcox.test(Winter_HW$Weight[Winter_HW$Sex == "M"],
            Winter_HW$Weight[Winter_HW$Sex == "F"])

ggplot(Winter_HW, aes(x = Sex, y = Weight))+
  geom_boxplot(fill ="cadetblue1")+
  stat_compare_means(method = "wilcox.test", comparisons = list(c("F", "M")))+
  labs(title = "Competitors Weight on Winter Olympic Games",
       caption = "wilcoxon test performed")
```

#### Compare Age

```{r}
wilcox.test(Winter$Age[Winter$Sex == "M"],
            Winter$Age[Winter$Sex == "F"])

ggplot(Winter, aes(x = Sex, y = Age))+
  geom_boxplot(fill = "cadetblue1")+
  stat_compare_means(method = "wilcox.test", comparisons = list(c("F", "M")))+
  labs(title = "Competitors Age on Winter Olympic Games", 
       caption = "wilcoxon test performed" )
```

### Inspect the connection between Team and medal

At first we preprocessed data to count overall number of Medals per team. Then we used chi-square test to releive the connection between variables. 

```{r}
Medals <- filter(filt_frame, Medal != "participant")
Medals$Medal <- 1
Tab_Medals <- table(Medals$Team, Medals$Medal)
chisq.test(Tab_Medals)
```
### Explore the most "Young" and the most "Elder" sport

We firstly search for the sports with minimum and maximum mean age 

```{r}
sport_with_min_max_mean_age <- group_by(filt_frame, Sport) %>% 
  summarise(mean_Age = round(mean(Age), digits = 3)) %>%
  filter(mean_Age %in% c(max(mean_Age), min(mean_Age)))
tableHTML(sport_with_min_max_mean_age)
```

Then we calculated the number of observations connected with these sports

```{r}
Rhythmic_Gymnastics <- filter(filt_frame, Sport == "Rhythmic Gymnastics")
nrow(Rhythmic_Gymnastics)
```

```{r}
Roque <- filter(filt_frame, Sport == "Roque")
nrow(Roque)
```
It turned out that there are to little observations in sport Roque. But it is still worthly to work with Rhythmic Gymnastics. We calculated mean age throughout the dataframe to compare it with mean age of Rhythmic Gymnastics

```{r}
global_mean_age <- mean(filt_frame$Age)
global_mean_age
```

Since the number of observations in Rhythmic Gymnastics seem to allow us to use t-test we dropped duplicated names so there is no more dependent observations. Then calculated the number of observations again

```{r}
Rhythmic_Gymnastics_unique <- distinct(Rhythmic_Gymnastics, Name, .keep_all = T)
nrow(Rhythmic_Gymnastics_unique)
```

Performed t-test showed that competitors in Rhythmic Gymnastics have significantly different average age in comparison to average age of overall competitors

```{r}
t.test(Rhythmic_Gymnastics_unique$Age, mu = global_mean_age, 
       alternative = "two.sided")
```



